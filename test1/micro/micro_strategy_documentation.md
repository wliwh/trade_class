# 搅屎棍策略

本系统基于 JoinQuant 社区的“中证2000搅屎棍策略” (`jsg_2000.py`) 启发而构建，旨在通过监测特定防御性板块（“搅屎棍”）的市场微观结构变化，来预警市场风险。

## 1. 策略起源与核心逻辑

### 来源
*   **参考代码**: `test1/micro/jsg_2000.py`
*   **原始文章**: [JoinQuant: 中证2000搅屎棍指数增强策略](https://www.joinquant.com/post/56890)

### 核心观点
市场中存在四大“搅屎棍”板块：**银行、有色、钢铁、煤炭**。
*   逻辑推演：这些板块通常具有防御属性。当市场资金大举进攻这些板块，导致它们在市场宽度排行榜上占据榜首（TOP1）时，往往意味着市场情绪趋于保守，或者主线资金正在撤退，预示着大盘（尤其是题材股/小盘股）可能即将崩盘。

### 原始策略风控逻辑
在 `jsg_2000.py` 中，策略逻辑非常直接：
1.  计算全市场各行业的“市场宽度”（收盘价 > 20日均线的个股比例）。
2.  **触发空仓**：如果 **银行、有色、钢铁、煤炭** 中任意一个行业的宽度排名进入全市场前 1 (或前 N)，则清仓离场。

## 2. 本地化实现架构

我们没有直接照搬自动交易策略，而是将其转化为一个**可视化分析系统**，辅助人工判断。该系统由两个Python脚本组成，分别负责“数据计算”和“可视化呈现”。

### 2.1 数据计算层: `market_breadth.py`

此脚本负责“全息扫描”，计算原始的市场宽度数据。

*   **功能**:
    *   遍历全市场所有股票，计算各自行业内部处于 **20日均线之上** 的股票比例。
    *   生成一份按日期索引的“行业热度/宽度”数据表。
    *   支持数据增量更新，保存为 `industries_score.csv`。
*   **关键输出**: 包含各行业每日宽度数值的 CSV 文件，作为下一步可视化的数据源。

### 2.2 可视化分析层: `plt_indus_breadth.py`

此脚本是策略逻辑的**视觉化呈现**，将“搅屎棍”逻辑映射到 K 线图上。

*   **配置**:
    *   定义了四大金刚的颜色映射 (`JSG_Color_Map`)：
        *   银行: 绿色 (`#009683`)
        *   煤炭: 黑色 (`#2a2a2a`)
        *   钢铁: 蓝色 (`#4682b4`)
        *   有色: 金色 (`#d4af37`)
    *   **Base_Code**: 默认参照指数 `399303` (国证2000) —— 正是原策略针对的目标群体。

*   **核心逻辑实现 (`get_industries_dic` & `get_industries_rank`)**:
    *   读取 `market_breadth.py` 生成的宽度数据。
    *   **排序**: 对每日各行业宽度进行排名。
    *   **筛选**: 专门检查四大“搅屎棍”板块是否进入了 **前2名** (`Rank_Threshold = 2`)。
        *   *注：这里比原策略稍宽松，原策略是TOP1，这里是TOP2，增强了预警敏感度。*
    *   **评分**: 根据排名给予评分（排第一扣分更多），计算出一个综合的“搅屎棍指数”。

*   **图表展示**:
    *   **K线主图**: 画出国证2000指数的走势。
    *   **顶部标记 (MarkPoints)**: 在K线上方，用对应颜色的圆点（绿/黑/蓝/金）标记出当天是由哪个“搅屎棍”板块领涨。
        *   **视觉信号**: 当K线上方密集出现这些颜色的圆点时，直观地提示用户：当前市场防御情绪浓重，风险较高。
    *   **副图**: 展示计算出的“搅屎棍Score”和全市场平均宽度，辅助判断市场热度是否冰点或过热。

## 3. 总结

本系统是对 `jsg_2000.py` 策略思想的工具化延伸：

*   `jsg_2000.py` 是**决策**：看到银行第一就跑。
*   `market_breadth.py` 是**数据**：负责算谁第一。
*   `plt_indus_breadth.py` 是**监控**：把“谁第一”画在图上，让你直观地看到“银行/煤炭”什么时候在领跑，从而辅助你做出“是否要跑”的决策。
